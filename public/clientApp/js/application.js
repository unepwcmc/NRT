!function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t["section.hbs"]=e(function(e,t,a,n,r){function s(e,t,n){var r,s,i="";return i+="\n  ",s={hash:{narrative:e},data:t},i+=p((r=a.addSubViewTo||e.addSubViewTo,r?r.call(e,n.thisView,"NarrativeView",s):h.call(e,"addSubViewTo",n.thisView,"NarrativeView",s)))+"\n"}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),r=r||{};var i,o="",h=a.helperMissing,p=this.escapeExpression,c=this;return o+="<h1>Section</h1>\n",i=a.each.call(t,t.narratives,{hash:{},inverse:c.noop,fn:c.programWithDepth(1,s,r,t),data:r}),(i||0===i)&&(o+=i),o+='\n<a class="btn add-narrative">\n	Add Narrative\n</a>\n'}),t["report.hbs"]=e(function(e,t,a,n,r){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),r=r||{};var s,i="",o="function",h=this.escapeExpression;return i+="<h1>Report</h1>\n<p>"+h((s=t.report,s=null==s||s===!1?s:s.overview,typeof s===o?s.apply(t):s))+"</p>\n"}),t["narrative.hbs"]=e(function(e,t,a,n,r){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),r=r||{};var s,i="",o="function",h=this.escapeExpression;return i+="<p class='content-text'>",(s=a.content)?s=s.call(t,{hash:{},data:r}):(s=t.content,s=typeof s===o?s.apply(t):s),i+=h(s)+"</p>\n"}),t["narrative-edit.hbs"]=e(function(e,t,a,n,r){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),r=r||{};var s,i="",o="function",h=this.escapeExpression;return i+="<textarea class='content-text-field'>",(s=a.content)?s=s.call(t,{hash:{},data:r}):(s=t.content,s=typeof s===o?s.apply(t):s),i+=h(s)+"</textarea>\n<a class='btn btn-primary save-narrative'>Save changes</a>\n"})}();

;
// Generated by CoffeeScript 1.6.3
(function() {
  var _base, _base1, _base2, _base3, _base4, _base5, _base6, _ref, _ref1, _ref2, _ref3, _ref4, _ref5,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  (_base = window.Backbone).Models || (_base.Models = {});

  window.Backbone.Models.Report = (function(_super) {
    __extends(Report, _super);

    function Report() {
      _ref = Report.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    return Report;

  })(Backbone.Model);

  (_base1 = window.Backbone).Models || (_base1.Models = {});

  window.Backbone.Models.Narrative = (function(_super) {
    __extends(Narrative, _super);

    function Narrative() {
      _ref1 = Narrative.__super__.constructor.apply(this, arguments);
      return _ref1;
    }

    Narrative.prototype.defaults = {
      content: "Narrative goes here.",
      title: "title",
      editing: true
    };

    Narrative.prototype.url = "/api/narrative";

    return Narrative;

  })(Backbone.Model);

  window.Backbone || (window.Backbone = {});

  (_base2 = window.Backbone).Collections || (_base2.Collections = {});

  Backbone.Collections.NarrativeCollection = (function(_super) {
    __extends(NarrativeCollection, _super);

    function NarrativeCollection() {
      _ref2 = NarrativeCollection.__super__.constructor.apply(this, arguments);
      return _ref2;
    }

    NarrativeCollection.prototype.model = Backbone.Models.Narrative;

    NarrativeCollection.prototype.url = "/api/narrative";

    return NarrativeCollection;

  })(Backbone.Collection);

  window.Backbone || (window.Backbone = {});

  (_base3 = window.Backbone).Views || (_base3.Views = {});

  Backbone.Views.SectionView = (function(_super) {
    __extends(SectionView, _super);

    function SectionView() {
      this.addNarrative = __bind(this.addNarrative, this);
      this.render = __bind(this.render, this);
      _ref3 = SectionView.__super__.constructor.apply(this, arguments);
      return _ref3;
    }

    SectionView.prototype.template = Handlebars.templates['section.hbs'];

    SectionView.prototype.events = {
      "click .add-narrative": "addNarrative"
    };

    SectionView.prototype.initialize = function(options) {
      this.narratives = options.narratives;
      this.narratives.bind('add', this.render);
      this.narratives.bind('sync', this.render);
      return this.render();
    };

    SectionView.prototype.render = function() {
      this.closeSubViews();
      this.$el.html(this.template({
        thisView: this,
        narratives: this.narratives.models
      }));
      this.renderSubViews();
      return this;
    };

    SectionView.prototype.addNarrative = function() {
      var newNarrative;
      newNarrative = new Backbone.Models.Narrative();
      return this.narratives.push(newNarrative);
    };

    SectionView.prototype.onClose = function() {
      return this.closeSubViews();
    };

    return SectionView;

  })(Backbone.Diorama.NestingView);

  window.Backbone || (window.Backbone = {});

  (_base4 = window.Backbone).Views || (_base4.Views = {});

  Backbone.Views.ReportView = (function(_super) {
    __extends(ReportView, _super);

    function ReportView() {
      this.render = __bind(this.render, this);
      _ref4 = ReportView.__super__.constructor.apply(this, arguments);
      return _ref4;
    }

    ReportView.prototype.template = Handlebars.templates['report.hbs'];

    ReportView.prototype.initialize = function(options) {
      this.report = options.report;
      return this.render();
    };

    ReportView.prototype.render = function() {
      this.closeSubViews();
      this.$el.html(this.template({
        thisView: this,
        report: this.report.toJSON()
      }));
      this.renderSubViews();
      return this;
    };

    ReportView.prototype.onClose = function() {
      return this.closeSubViews();
    };

    return ReportView;

  })(Backbone.Diorama.NestingView);

  window.Backbone || (window.Backbone = {});

  (_base5 = window.Backbone).Views || (_base5.Views = {});

  Backbone.Views.NarrativeView = (function(_super) {
    __extends(NarrativeView, _super);

    function NarrativeView() {
      this.startEdit = __bind(this.startEdit, this);
      this.saveNarrative = __bind(this.saveNarrative, this);
      this.render = __bind(this.render, this);
      _ref5 = NarrativeView.__super__.constructor.apply(this, arguments);
      return _ref5;
    }

    NarrativeView.prototype.template = Handlebars.templates['narrative.hbs'];

    NarrativeView.prototype.editTemplate = Handlebars.templates['narrative-edit.hbs'];

    NarrativeView.prototype.events = {
      "click .save-narrative": "saveNarrative",
      "click .content-text": "startEdit"
    };

    NarrativeView.prototype.initialize = function(options) {
      this.narrative = options.narrative;
      this.narrative.bind('change', this.render);
      return this.render();
    };

    NarrativeView.prototype.render = function() {
      if (this.narrative.get('editing')) {
        this.$el.html(this.editTemplate(this.narrative.toJSON()));
      } else {
        this.$el.html(this.template(this.narrative.toJSON()));
      }
      return this;
    };

    NarrativeView.prototype.saveNarrative = function(event) {
      this.narrative.set('title', "title");
      this.narrative.set('content', this.$el.find('.content-text-field').val().replace(/^\s+|\s+$/g, ''));
      this.narrative.set('editing', false);
      return this.narrative.save();
    };

    NarrativeView.prototype.startEdit = function() {
      this.narrative.set('editing', true);
      return this.render();
    };

    NarrativeView.prototype.onClose = function() {};

    return NarrativeView;

  })(Backbone.View);

  window.Backbone || (window.Backbone = {});

  (_base6 = window.Backbone).Controllers || (_base6.Controllers = {});

  Backbone.Controllers.ReportsController = (function(_super) {
    __extends(ReportsController, _super);

    function ReportsController() {
      var narratives, sectionView;
      this.mainRegion = new Backbone.Diorama.ManagedRegion();
      $('#user-section').prepend(this.mainRegion.$el);
      narratives = new Backbone.Collections.NarrativeCollection();
      narratives.fetch();
      sectionView = new Backbone.Views.SectionView({
        narratives: narratives
      });
      this.mainRegion.showView(sectionView);
    }

    return ReportsController;

  })(Backbone.Diorama.Controller);

  Handlebars.registerHelper("debug ", function(optionalValue) {
    console.log("Current Context");
    console.log("====================");
    console.log(this);
    if (optionalValue) {
      console.log("Value");
      console.log("====================");
      return console.log(optionalValue);
    }
  });

}).call(this);
